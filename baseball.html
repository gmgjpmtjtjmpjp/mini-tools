<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>野球ゲーム（ピッチャー＆バッター）</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body { text-align: center; background: #e8f5e9; font-family: sans-serif; }
  canvas { background: #fff; display: block; margin: 20px auto; border: 2px solid #000; }
  button { padding: 8px 15px; margin: 5px; border-radius: 5px; border: none; background: #4caf50; color: white; font-size: 16px; }
  h1 { margin-top: 20px; }
</style>
</head>
<body>
<h1>野球ゲーム</h1>
<div id="menu">
  <button onclick="startPitcher()">ピッチャーで遊ぶ</button>
  <button onclick="startBatter()">バッターで遊ぶ</button>
  <button onclick="location.href='index.html'">← 戻る</button>
</div>

<canvas id="gameCanvas" width="400" height="300" style="display:none;"></canvas>
<p id="scoreText"></p>
<p id="timeText"></p>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
let mode = "";
let ball = {x: 0, y: 150, speedX: 0, speedY: 0, radius: 8};
let bat = {x: 350, y: 150, width: 10, height: 50};
let strikeZone = {x: 300, y: 100, width: 10, height: 100};
let score = 0;
let timeLeft = 30;
let gameRunning = false;
let timerInterval;

function drawBall() {
  ctx.beginPath();
  ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
  ctx.fillStyle = "#f44336";
  ctx.fill();
}

function drawBat() {
  ctx.fillStyle = "#4caf50";
  ctx.fillRect(bat.x, bat.y - bat.height/2, bat.width, bat.height);
}

function drawStrikeZone() {
  ctx.strokeStyle = "#2196f3";
  ctx.strokeRect(strikeZone.x, strikeZone.y, strikeZone.width, strikeZone.height);
}

function resetBallPitcher() {
  ball.x = 50;
  ball.y = Math.random() * (canvas.height - 20) + 10;
  ball.speedX = 0;
}

function resetBallBatter() {
  ball.x = 0;
  ball.y = Math.random() * (canvas.height - 20) + 10;
  ball.speedX = 3 + Math.random() * 2;
}

function updatePitcher() {
  if (!gameRunning) return;
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  drawStrikeZone();
  ball.x += ball.speedX;
  if (ball.x > strikeZone.x && ball.x < strikeZone.x + strikeZone.width && ball.speedX > 0) {
    score++;
    document.getElementById('scoreText').textContent = "ストライク！ スコア: " + score;
    resetBallPitcher();
  }
  drawBall();
  requestAnimationFrame(updatePitcher);
}

function updateBatter() {
  if (!gameRunning) return;
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ball.x += ball.speedX;
  if (ball.x > canvas.width) {
    resetBallBatter();
  }
  if (ball.x + ball.radius > bat.x &&
      ball.y > bat.y - bat.height/2 &&
      ball.y < bat.y + bat.height/2) {
    score++;
    document.getElementById('scoreText').textContent = "ヒット！ スコア: " + score;
    resetBallBatter();
  }
  drawBall();
  drawBat();
  requestAnimationFrame(updateBatter);
}

function startPitcher() {
  mode = "pitcher";
  document.getElementById('menu').style.display = "none";
  canvas.style.display = "block";
  score = 0; timeLeft = 30;
  document.getElementById('scoreText').textContent = "スコア: 0";
  document.getElementById('timeText').textContent = "残り時間: 30秒";
  gameRunning = true;
  resetBallPitcher();
  clearInterval(timerInterval);
  timerInterval = setInterval(countdown, 1000);
  canvas.addEventListener('click', () => { if (mode === "pitcher") ball.speedX = 5; });
  updatePitcher();
}

function startBatter() {
  mode = "batter";
  document.getElementById('menu').style.display = "none";
  canvas.style.display = "block";
  score = 0; timeLeft = 30;
  document.getElementById('scoreText').textContent = "スコア: 0";
  document.getElementById('timeText').textContent = "残り時間: 30秒";
  gameRunning = true;
  resetBallBatter();
  clearInterval(timerInterval);
  timerInterval = setInterval(countdown, 1000);
  updateBatter();
}

function countdown() {
  timeLeft--;
  document.getElementById('timeText').textContent = "残り時間: " + timeLeft + "秒";
  if (timeLeft <= 0) {
    clearInterval(timerInterval);
    gameRunning = false;
    alert("ゲーム終了！ スコア: " + score);
    location.reload();
  }
}

canvas.addEventListener('mousemove', e => {
  if (mode === "batter") {
    const rect = canvas.getBoundingClientRect();
    bat.y = e.clientY - rect.top;
  }
});

canvas.addEventListener('touchmove', e => {
  if (mode === "batter") {
    const rect = canvas.getBoundingClientRect();
    bat.y = e.touches[0].clientY - rect.top;
    e.preventDefault();
  }
}, {passive: false});
</script>
</body>
</html>
